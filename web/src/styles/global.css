/* Global styles - typography, links, code, tables, KaTeX */

/* Typography */
h1, h2, h3, h4, h5, h6 {
  font-weight: 600;
  line-height: 1.3;
  margin-top: 1.5em;
  margin-bottom: 0.5em;
  color: var(--color-text);
}

h1 { font-size: 2rem; margin-top: 0; }
h2 { font-size: 1.5rem; border-bottom: 1px solid var(--color-border); padding-bottom: 0.25em; }
h3 { font-size: 1.25rem; }
h4 { font-size: 1.125rem; }
h5, h6 { font-size: 1rem; }

p {
  margin-bottom: 1em;
}

/* Links - ensure no underlines globally */
a,
a:link,
a:visited,
a:hover,
a:active {
  text-decoration: none;
}

:global(.content a) {
  color: var(--color-accent);
  text-decoration: none;
  transition: color var(--transition-fast);
}

:global(.content a:hover) {
  color: var(--color-accent-hover);
}

/* Lists */
:global(.content ul),
:global(.content ol) {
  margin-bottom: 1em;
  padding-left: 1.5em;
}

:global(.content ul) {
  list-style-type: none;
}

:global(.content ol) {
  list-style-type: decimal;
}

:global(.content li) {
  margin-bottom: 0.25em;
}

:global(.content li > ul),
:global(.content li > ol) {
  margin-top: 0.25em;
  margin-bottom: 0;
}

/* Inline code */
:global(.content code:not(pre code)) {
  background-color: var(--color-bg-muted);
  padding: 0.15em 0.35em;
  border-radius: var(--radius-sm);
  font-family: var(--font-mono);
  font-size: 0.875em;
}

/* Code blocks */
:global(.content pre) {
  background-color: transparent !important;
  border: none;
  border-left: 3px solid var(--color-code-border);
  border-radius: 0;
  padding: 1rem;
  overflow-x: auto;
  margin-bottom: 1em;
  position: relative;
}

:global(.content pre code) {
  font-family: var(--font-mono);
  font-size: 0.875rem;
  line-height: 1.5;
}

/* Code block copy button */
:global(.content pre .copy-button) {
  position: absolute;
  top: 0.5rem;
  right: 0.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0.375rem;
  background: transparent;
  border: none;
  border-radius: var(--radius-md);
  color: var(--color-text-muted);
  opacity: 0;
  transition:
    opacity var(--transition-fast),
    color var(--transition-fast),
    background-color var(--transition-fast);
}

:global(.content pre:hover .copy-button) {
  opacity: 1;
}

:global(.content pre .copy-button:hover) {
  color: var(--color-accent);
  background-color: var(--color-bg-muted);
}

:global(.content pre .copy-button.copied) {
  color: var(--color-success);
}

/* Tables */
:global(.content table) {
  border-collapse: separate;
  border-spacing: 0;
  font-size: 0.9375rem;
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  margin: 1.5em 0;
  overflow: hidden;
}

:global(.content th),
:global(.content td) {
  padding: 0.75rem 1rem;
  text-align: left;
}

:global(.content th) {
  font-weight: 600;
  color: var(--color-text);
  background: var(--color-bg-muted);
  border-bottom: 1px solid var(--color-border);
  white-space: nowrap;
}

:global(.content td) {
  border-bottom: 1px solid var(--color-border);
}

:global(.content tr:last-child td) {
  border-bottom: none;
}

:global(.content tbody tr) {
  transition: background-color var(--transition-fast);
}

:global(.content tbody tr:hover) {
  background-color: var(--color-bg-muted);
}

/* Blockquotes */
:global(.content blockquote) {
  border-left: 3px solid var(--color-accent);
  padding: 0.75rem 1rem;
  margin: 1.5em 0;
  color: var(--color-text-muted);
  background: var(--color-bg-muted);
  border-radius: 0 var(--radius-md) var(--radius-md) 0;
}

:global(.content blockquote p:last-child) {
  margin-bottom: 0;
}

/* Horizontal rules */
:global(.content hr) {
  border: none;
  height: 1px;
  background: linear-gradient(
    to right,
    transparent,
    var(--color-border) 20%,
    var(--color-border) 80%,
    transparent
  );
  margin: 2.5em 0;
}

/* Images */
:global(.content img) {
  max-width: 100%;
  height: auto;
  border-radius: var(--radius-md);
  margin: 1em auto;
  display: block;
}

/* Responsive image sizing */
@media (min-width: 640px) {
  :global(.content img) {
    max-width: 80%;
  }
}

@media (min-width: 1024px) {
  :global(.content img) {
    max-width: 70%;
  }
}

/* Themed images - show/hide based on data-theme attribute */
:global(.themed-image) {
  display: block;
  text-align: center;
}

:global(.themed-image img) {
  margin: 1em auto;
}

/* Dark theme (default): show dark, hide light */
:global(.themed-image .theme-light) {
  display: none;
}

:global(.themed-image .theme-dark) {
  display: block;
}

/* Light theme: show light, hide dark */
:global([data-theme='light'] .themed-image .theme-light) {
  display: block;
}

:global([data-theme='light'] .themed-image .theme-dark) {
  display: none;
}

/* KaTeX math styling */
:global(.katex-display) {
  margin: 1.5em 0;
  overflow-x: auto;
  overflow-y: hidden;
  padding: 0.5em 0;
}

:global(.katex) {
  font-size: 1.1em;
  color: var(--color-text);
}

/* Math in dark mode - ensure visibility */
:global([data-theme='dark'] .katex),
:global(:root:not([data-theme='light']) .katex) {
  color: var(--color-text);
}

/* Math inside links inherits link color (must follow dark mode rules for specificity) */
:global(.content a .katex),
:global([data-theme='dark'] .content a .katex),
:global(:root:not([data-theme='light']) .content a .katex) {
  color: inherit;
}

/* Shiki/Astro code block theme switching
   Astro uses class 'astro-code' for Shiki code blocks.
   Dual-theme output: light colors are inline, dark colors are CSS variables.
   Light mode: inline styles apply directly (no override needed).
   Dark mode: override inline styles with --shiki-dark variables. */
:global(.astro-code),
:global(.astro-code span) {
  background-color: transparent !important;
}

:global([data-theme='dark'] .astro-code),
:global([data-theme='dark'] .astro-code span),
:global(:root:not([data-theme='light']) .astro-code),
:global(:root:not([data-theme='light']) .astro-code span) {
  color: var(--shiki-dark) !important;
}

/* Selection */
::selection {
  background-color: var(--color-accent-muted);
  color: var(--color-text);
}

/* Focus styles */
:focus-visible {
  outline: 2px solid var(--color-accent);
  outline-offset: 2px;
}

/* Anchor links for headings */
.heading-anchor {
  color: var(--color-text-muted);
  text-decoration: none;
  margin-left: 0.25em;
  opacity: 0;
  transition: opacity var(--transition-fast);
}

h2:hover .heading-anchor,
h3:hover .heading-anchor,
h4:hover .heading-anchor {
  opacity: 1;
}

.heading-anchor:hover {
  color: var(--color-accent);
}

/* Citations - use :global() to prevent Astro scoping */
:global(.citation) {
  color: var(--color-accent);
  cursor: pointer;
  font-style: normal;
}

/* Citation popover */
:global(.citation-popover) {
  position: fixed;
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  padding: 0.75rem 1rem;
  max-width: 360px;
  box-shadow: var(--shadow-lg);
  z-index: 1000;
  font-size: 0.875rem;
  line-height: 1.5;
}

:global(.citation-popover-title) {
  font-weight: 600;
  margin-bottom: 0.25rem;
  color: var(--color-text);
}

:global(.citation-popover-authors) {
  color: var(--color-text-muted);
  margin-bottom: 0.25rem;
}

:global(.citation-popover-venue) {
  color: var(--color-text-muted);
  font-style: italic;
}

:global(.citation-popover-doi) {
  margin-top: 0.5rem;
}

:global(.citation-popover-doi a) {
  color: var(--color-accent);
}

/* Bibliography page - matches citation popover style */
:global(.bibliography) {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

:global(.bib-entry) {
  padding: 0.75rem 1rem;
  background: var(--color-bg-muted);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  line-height: 1.5;
}

:global(.bib-entry + .bib-entry) {
  margin-top: 1rem;
}

:global(.bib-title) {
  font-weight: 600;
  margin-bottom: 0.25rem;
  color: var(--color-text);
}

:global(.bib-authors) {
  color: var(--color-text-muted);
  margin-bottom: 0.25rem;
}

:global(.bib-venue) {
  color: var(--color-text-muted);
  font-style: italic;
}

:global(.bib-doi) {
  margin-top: 0.5rem;
}

:global(.bib-doi a) {
  color: var(--color-accent);
  font-size: 0.875rem;
}
