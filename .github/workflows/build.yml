name: build
run-name: "[build] ${{ github.event.head_commit.message }}"

on:
  pull_request:
  push:
  workflow_dispatch:

jobs:
  build-img:
    uses: ./.github/workflows/build-img.yml

  build-pdf:
    needs: build-img
    uses: ./.github/workflows/build-pdf.yml

  build-web:
    needs: [build-img, build-pdf]
    uses: ./.github/workflows/build-web.yml

  build-r:
    uses: ./.github/workflows/build-r.yml

  build-dotnet:
    uses: ./.github/workflows/build-dotnet.yml

  build-python:
    uses: ./.github/workflows/build-python.yml

  build-rust:
    uses: ./.github/workflows/build-rust.yml

  build-ts:
    uses: ./.github/workflows/build-ts.yml

  build-go:
    uses: ./.github/workflows/build-go.yml

  build-kotlin:
    uses: ./.github/workflows/build-kotlin.yml

  assemble-artifacts:
    runs-on: ubuntu-24.04
    needs: [build-web, build-r, build-pdf, build-dotnet, build-python, build-rust, build-ts, build-go, build-kotlin]
    steps:
    - name: Download web artifacts
      uses: actions/download-artifact@v4
      with:
        name: web
        path: artifacts/web

    - name: Download r artifacts
      uses: actions/download-artifact@v4
      with:
        name: r
        path: artifacts/r

    - name: Download pdf artifacts
      uses: actions/download-artifact@v4
      with:
        name: pdf
        path: artifacts/pdf

    - name: Download dotnet artifacts
      uses: actions/download-artifact@v4
      with:
        name: dotnet
        path: artifacts/dotnet

    - name: Download python artifacts
      uses: actions/download-artifact@v4
      with:
        name: python
        path: artifacts/python

    - name: Download rust artifacts
      uses: actions/download-artifact@v4
      with:
        name: rust
        path: artifacts/rust

    - name: Download ts artifacts
      uses: actions/download-artifact@v4
      with:
        name: ts
        path: artifacts/ts

    - name: Download go artifacts
      uses: actions/download-artifact@v4
      with:
        name: go
        path: artifacts/go

    - name: Download kotlin artifacts
      uses: actions/download-artifact@v4
      with:
        name: kotlin
        path: artifacts/kotlin

    - name: Upload combined artifacts
      uses: actions/upload-artifact@v4
      with:
        name: pragmastat
        path: artifacts/

